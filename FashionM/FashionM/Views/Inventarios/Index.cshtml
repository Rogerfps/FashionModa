@model IEnumerable<FashionM.Models.Inventario>

@{
    ViewData["Title"] = "Inventario";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">📦 Inventario</h2>

    <a asp-action="Create" class="btn btn-primary">
        ➕ Nuevo Inventario
    </a>
</div>

<form asp-action="Index" method="get" class="mb-3">
    <div class="input-group">
        <input type="text"
               name="search"
               value="@ViewBag.Search"
               class="form-control"
               placeholder="Buscar por código, marca o SKU..." />

        <button class="btn btn-outline-secondary" type="submit">
            🔍 Buscar
        </button>

        @if (!string.IsNullOrEmpty(ViewBag.Search))
        {
            <a asp-action="Index" class="btn btn-outline-danger">
                ❌ Limpiar
            </a>
        }
    </div>
</form>

<div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
        <thead class="table-dark">
            <tr>
                <th>Foto</th>
                <th>Código</th>
                <th>Producto</th>
                <th>SKU</th>
                <th>Precios</th>
                <th>Tallas</th>
                <th>Stock Total</th>
                <th class="text-center">Acciones</th>
            </tr>
        </thead>

        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        @if (item.Fotos != null && item.Fotos.Any())
                        {
                            <img src="@item.Fotos.First().Ruta"
                                 alt="Foto zapato"
                                 style="width:80px;
                            height:80px;
                            object-fit:cover;
                            border-radius:8px;
                            border:1px solid #ccc;" />
                        }
                        else
                        {
                            <span class="text-muted">Sin imagen</span>
                        }
                    </td>

                    <td class="fw-bold">@item.Codigo</td>

                    <td>
                        <div><strong>Marca:</strong> @item.Marca</div>
                        <div><strong>Color:</strong> @item.Color</div>
                        <div class="text-muted small">@item.Detalle</div>
                    </td>

                    <td>@item.SKU</td>

                    <td>
                        <div><strong>Costo:</strong> ₡@item.PrecioCosto</div>
                        <div><strong>Venta:</strong> ₡@item.PrecioVenta</div>
                    </td>

                    <td>
                        @if (item.Tallas != null && item.Tallas.Any())
                        {
                            foreach (var talla in item.Tallas.OrderBy(t => t.Numero))
                            {
                                <span class="badge bg-secondary me-1 mb-1">
                                    @talla.Numero : @talla.Cantidad
                                </span>
                            }
                        }
                        else
                        {
                            <span class="text-muted">Sin tallas</span>
                        }
                    </td>

                    <td>
                        <span class="badge bg-success">
                            @item.StockTotal
                        </span>
                    </td>

                    <td class="text-center">
                        <div class="d-flex justify-content-center gap-2">

                            <a asp-action="Details"
                               asp-route-id="@item.Codigo"
                               class="btn btn-info btn-sm">
                                👁 Ver
                            </a>

                            <a asp-action="Edit"
                               asp-route-id="@item.Codigo"
                               class="btn btn-sm btn-warning">
                                ✏️
                            </a>

                            <form asp-action="Delete"
                                  method="post"
                                  onsubmit="return confirm('¿Eliminar este inventario?')">

                                <input type="hidden" name="codigo" value="@item.Codigo" />
                                @Html.AntiForgeryToken()

                                <button class="btn btn-sm btn-danger">
                                    🗑
                                </button>
                            </form>

                        </div>
                    </td>
                </tr>
            }

            @if (ViewBag.TotalPages > 1)
            {
                <nav>
                    <ul class="pagination justify-content-center">

                        <!-- ⬅ Anterior -->
                        <li class="page-item @(ViewBag.CurrentPage == 1 ? "disabled" : "")">
                            <a class="page-link"
                               asp-action="Index"
                               asp-route-page="@(ViewBag.CurrentPage - 1)"
                               asp-route-search="@ViewBag.Search">
                                Anterior
                            </a>
                        </li>

                        <!-- Páginas -->
                        @for (int i = 1; i <= ViewBag.TotalPages; i++)
                        {
                            <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                                <a class="page-link"
                                   asp-action="Index"
                                   asp-route-page="@i"
                                   asp-route-search="@ViewBag.Search">
                                    @i
                                </a>
                            </li>
                        }

                        <!-- ➡ Siguiente -->
                        <li class="page-item @(ViewBag.CurrentPage == ViewBag.TotalPages ? "disabled" : "")">
                            <a class="page-link"
                               asp-action="Index"
                               asp-route-page="@(ViewBag.CurrentPage + 1)"
                               asp-route-search="@ViewBag.Search">
                                Siguiente
                            </a>
                        </li>

                    </ul>
                </nav>
            }
        </tbody>
    </table>
</div>